<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
  </head>
  <body>

  <form>
    <input type="text" class="food-type" placeholder="food" />
    <input type="submit" />
  </form>

  <div class="foods" style="display: hidden"></div>


  <script src="http://maps.googleapis.com/maps/api/js?key=<%=ENV["GOOGLE_API"]%>&libraries=places,geometry&sensor=false">
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

  <script type="text/javascript">
var map;
    var initialize = function () {
    // submit can only be used on a forum
      $('form').on('submit', function (e) {
        e.preventDefault();

        // $.get( "/address", {searchTerm: $('.food-type').val()}, function (data) {
        //   // might need to do this
        //    // var data = $.parseJSON(data)

        //   console.log("Got data:", data);
        //   // console.log("data size:", Object.keys(data).length);
        // });


      var mapProp = {
        center: new google.maps.LatLng(30.2729209,97.74438630000003), //austin
        zoom: 15,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };

      map = new google.maps.Map(document.getElementById("map-canvas"), mapProp);
      // ajax request

      var defaultBounds = new google.maps.LatLngBounds(
        new google.maps.LatLng(30.343843,-97.744386),
        new google.maps.LatLng(30.272921,-97.744386));
      map.fitBounds(defaultBounds)


        $.ajax({
          type: "GET",
          url:'/address',
          "data": {
            searchTerm: $('.food-type').val()
          },
          success: function(data) {
            var lat = '';
            var lng = '';
            var geocoder= new google.maps.Geocoder();
            console.log(data);
            for(var i = 0; i < data.length; i++) {
              // debugger;
               console.log( data[i]['location']['address'] + ' ' + data[i]['location']['city'] + ' ' + data[i]['location']['state_code'] + ' ' + data[i]['location']['country_code']     );

              geocoder.geocode( { "address": data[i]['location']['address'] + ' ' + data[i]['location']['city'] + ' ' + data[i]['location']['state_code'] + ' ' + data[i]['location']['country_code']   }, function(results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                  lat = results[0].geometry.location.lat();
                  lng = results[0].geometry.location.lng();
                }

                var marker = new google.maps.Marker({
                  position: new google.maps.LatLng(lat,lng),
                  map: map,
                  title: 'Hello World!'
                });
              console.log(marker.position);
              });


              console.log(data[i]['name']);
              //console.log(data[i]['location']['address'][0]);
              console.log(data[i]['location']['city'])
              console.log(data[i]['location']['state_code'])
              console.log(data[i]['location']['country_code'])
              //place a marker for that location address
              //if data[i]['rating'] === '5'


            }
            // for(var i = 0; i < data.length; i++){
            //   console.log(data[i]['rating'])

            // }
            //loop through data
              //console.log each address
              //place marker at that address
            // console.log(data[0]['location']['address'][0]);
          }})




      });
    };

      google.maps.event.addDomListener(window, 'load', initialize);

    </script>
    <div id="map-canvas"></div>
  </body>
</html>




